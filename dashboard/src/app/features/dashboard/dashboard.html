<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <button
          class="home-btn btn btn-ghost"
          (click)="navigateToHome()"
          title="Back to Home"
        >
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
          </svg>
          <span>Home</span>
        </button>

        <button
          class="back-btn"
          (click)="navigateBack()"
          title="Back to Servers"
        >
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"
            />
          </svg>
        </button>

        @if (store.guildInfo()) {
        <div class="guild-info">
          <img
            [src]="getGuildIconUrl()"
            [alt]="store.guildInfo()!.name"
            class="guild-avatar"
          />
          <div class="guild-details">
            <h1 class="guild-name">{{ store.guildInfo()!.name }}</h1>
            <p class="page-subtitle">Server Dashboard</p>
          </div>
        </div>
        } @else {
        <div class="guild-info">
          <div class="guild-avatar-skeleton"></div>
          <div class="guild-details">
            <div class="guild-name-skeleton"></div>
            <p class="page-subtitle">Server Dashboard</p>
          </div>
        </div>
        }
      </div>

      <div class="header-right">
        <div
          class="real-time-indicator"
          [class.connected]="!!store.lastEvent()"
        >
          <div class="status-dot"></div>
          <span>{{ store.lastEvent() ? 'Live' : 'Connecting...' }}</span>
        </div>

        <button class="logout-btn" (click)="logout()" title="Logout">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"
            />
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">
    <!-- Error handling -->
    @if (store.error()) {
      <div class="alert alert-error" (click)="clearError()">
        <span>{{ store.error() }}</span>
        <button class="close-btn">Ã—</button>
      </div>
    }

    <!-- Progressive Loading States -->
    @if (store.isLoading() && !store.isBasicDataLoaded()) {
      <!-- Initial loading spinner -->
      <div class="loading-state">
        <div class="loading-spinner"></div>
        <p>Connecting to server...</p>
      </div>
    } @else {
      <!-- Basic UI is ready, show content with progressive enhancements -->
      <div class="dashboard-content">
        <!-- Sidebar Navigation -->
        <app-sidebar-navigation></app-sidebar-navigation>

        <!-- Router Outlet for Child Routes -->
        <section class="main-content">
          <!-- Commands loading indicator -->
          @if (store.isCommandsLoading()) {
            <div class="commands-loading-overlay">
              <div class="loading-progress">
                <div class="loading-spinner-small"></div>
                <span>Loading commands and permissions...</span>
              </div>
            </div>
          }
          
          <router-outlet></router-outlet>
        </section>
      </div>
    }
  </main>
</div>
