<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <button
          class="home-btn btn btn-ghost"
          (click)="navigateToHome()"
          title="Back to Home"
        >
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
          </svg>
          <span>Home</span>
        </button>

        <button
          class="back-btn"
          (click)="navigateBack()"
          title="Back to Servers"
        >
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"
            />
          </svg>
        </button>

        @if (store.guildInfo()) {
        <div class="guild-info">
          <img
            [src]="getGuildIconUrl()"
            [alt]="store.guildInfo()!.name"
            class="guild-avatar"
          />
          <div class="guild-details">
            <h1 class="guild-name">{{ store.guildInfo()!.name }}</h1>
            <p class="page-subtitle">Command Management Dashboard</p>
          </div>
        </div>
        } @else {
        <div class="guild-info">
          <div class="guild-avatar-skeleton"></div>
          <div class="guild-details">
            <div class="guild-name-skeleton"></div>
            <p class="page-subtitle">Command Management Dashboard</p>
          </div>
        </div>
        }
      </div>

      <div class="header-right">
        <div
          class="real-time-indicator"
          [class.connected]="!!store.lastEvent()"
        >
          <div class="status-dot"></div>
          <span>{{ store.lastEvent() ? 'Live' : 'Connecting...' }}</span>
        </div>

        <button class="logout-btn" (click)="logout()" title="Logout">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"
            />
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">
    <!-- @if (store.error()) {
      <div class="alert alert-error" (click)="clearError()">
        <span>{{ store.error() }}</span>
        <button class="close-btn">×</button>
      </div>
    } -->

    @if (store.isLoading()) {
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <p>Loading server configuration...</p>
    </div>
    } @else {
    <div class="dashboard-content">
      <!-- Sidebar Navigation -->
      <aside class="dashboard-sidebar">
        <div class="sidebar-header">
          <h3>Categories</h3>
        </div>

        <nav class="category-nav">
          @for (category of store.commandsCategories().values(); track
          category.id) {
          <button
            class="category-item"
            [class.active]="selectedCategory()?.id === category.id"
            (click)="selectCategory(category)"
          >
            <span class="category-name">{{ category.name }}</span>
            <span class="category-count"
              >{{ store.commandsCategories().get(category.id)?.commands?.length
              ?? 0 }}</span
            >
          </button>
          }
        </nav>

        <!-- Global Settings Section -->
        <!-- <div class="global-settings">
            <h4>Global Settings</h4>
            <div class="setting-group">
              <label>Global Command Prefix</label>
              <input type="text" value="/" disabled class="setting-input">
            </div>
          </div> -->
      </aside>

      <!-- Command List -->
      <section class="command-section">
        <div class="section-header">
          <h2>{{ selectedCategory()?.name }} Commands</h2>
          <p>Configure command permissions and settings for this category</p>
        </div>

        <div class="commands-grid">
          @for (command of selectedCategory()?.commands ?? []; track command.id)
          {
          <div class="command-card" [class.disabled]="!command.enabled">
            <div class="command-header">
              <div class="command-info">
                <h3 class="command-name">/{{ command.name }}</h3>
                <p class="command-description">{{ command.description }}</p>
              </div>

              <div class="command-controls">
                <label class="toggle-switch">
                  <input
                    type="checkbox"
                    [checked]="command.enabled"
                    (change)="store.toggleCommand({ commandId: command.id })"
                  />
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>

            <div class="command-meta">
              <div class="meta-item">
                <span class="meta-label">Status:</span>
                <span
                  class="status-badge"
                  [class.enabled]="command.enabled"
                  [class.disabled]="!command.enabled"
                >
                  {{ command.enabled ? 'Enabled' : 'Disabled' }}
                </span>
              </div>

              @if (command.whitelistedRoles && command.whitelistedRoles.length >
              0) {
              <div class="meta-item">
                <span class="meta-label">Whitelisted Roles:</span>
                <span class="meta-value"
                  >{{ command.whitelistedRoles.length }}</span
                >
              </div>
              } @if (command.blacklistedRoles && command.blacklistedRoles.length
              > 0) {
              <div class="meta-item">
                <span class="meta-label">Blacklisted Roles:</span>
                <span class="meta-value"
                  >{{ command.blacklistedRoles.length }}</span
                >
              </div>
              }
            </div>

            @if (getSubcommandCount(command) > 0) {
            <div class="subcommands-section">
              <h4 class="subcommands-title">
                Subcommands ({{ getSubcommandCount(command) }})
              </h4>
              <div class="subcommands-list">
                @for (subcommand of getSubcommands(command); track
                subcommand.id) {
                <div
                  class="subcommand-item"
                  [class.disabled]="!subcommand.enabled"
                >
                  <span class="subcommand-name"
                    >/{{ command.name }} {{ subcommand.name }}</span
                  >
                  <span class="subcommand-description"
                    >{{ subcommand.description }}</span
                  >
                  <label class="toggle-switch toggle-switch-sm">
                    <input
                      type="checkbox"
                      [checked]="subcommand.enabled"
                      (change)="store.toggleSubcommand({ commandId: command.id, subcommandName: subcommand.name })"
                    />
                    <span class="toggle-slider"></span>
                  </label>
                </div>
                }
              </div>
            </div>
            }

            <div class="command-actions">
              <button
                class="btn btn-primary btn-sm"
                (click)="openCommandConfig(command)"
              >
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path
                    d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"
                  />
                </svg>
                Configure
              </button>
            </div>
          </div>
          } @if (selectedCategory()?.commands?.length === 0) {
          <div class="empty-commands">
            <div class="empty-icon">⚙️</div>
            <h3>No commands in this category</h3>
            <p>This category doesn't have any commands yet.</p>
          </div>
          }
        </div>
      </section>
    </div>
    }
  </main>
</div>
