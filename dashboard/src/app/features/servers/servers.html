<div class="servers-container">
  <!-- Search and Actions -->
  <div class="servers-actions">
    <div class="search-container">
      <div class="search-input-wrapper">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="currentColor"
          class="search-icon"
        >
          <path
            d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
          />
        </svg>
        <input
          type="text"
          placeholder="Search servers..."
          class="search-input"
          [(ngModel)]="searchQuery"
        />
        @if (searchQuery()) {
        <button class="clear-search" (click)="clearSearch()">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path
              d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
            />
          </svg>
        </button>
        }
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="servers-main">
    @if (isLoading()) {
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <h3>Loading your servers...</h3>
      <p>Fetching server information from Discord</p>
    </div>
    } @else if (error()) {
    <div class="error-state card">
      <div class="error-icon">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
          />
        </svg>
      </div>
      <h3>Something went wrong</h3>
      <p>{{ error() }}</p>
      <button class="btn btn-primary" (click)="loadServers()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9z"
          />
        </svg>
        <span>Retry</span>
      </button>
    </div>
    } @else if (servers().length === 0) {
    <div class="empty-state card">
      <div class="empty-icon">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
          />
        </svg>
      </div>
      <h3>No Manageable Servers</h3>
      <p>You don't have permission to manage any servers with this bot.</p>
      <p class="help-text">
        You need <strong>Manage Server</strong>, <strong>Administrator</strong>,
        or be the <strong>Server Owner</strong> to access the dashboard.
      </p>
      <div class="empty-actions">
        <button class="btn btn-secondary" (click)="loadServers()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9z"
            />
          </svg>
          <span>Refresh</span>
        </button>

        <a
          href="https://discord.com/developers/applications"
          target="_blank"
          class="btn btn-ghost"
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"
            />
          </svg>
          <span>Invite Bot</span>
        </a>
      </div>
    </div>
    } @else {
    <div class="servers-content">
      <div class="servers-grid">
        @for (server of filteredServers(); track server.id) {
        <div
          class="server-card card animate-fade-in"
          (click)="navigateToServer(server.id)"
        >
          <div class="server-header">
            <div class="server-avatar">
              @if (server.icon) {
              <img
                [src]="
                  'https://cdn.discordapp.com/icons/' +
                  server.id +
                  '/' +
                  server.icon +
                  '.png?size=128'
                "
                [alt]="server.name"
                class="server-icon"
              />
              } @else {
              <div class="server-icon-fallback">
                {{ getServerInitials(server.name) }}
              </div>
              }
            </div>

            <div class="server-info">
              <h3 class="server-name">{{ server.name }}</h3>
              <p class="server-description">Click to manage bot settings</p>
            </div>
          </div>

          <div class="server-actions">
            <button class="btn btn-primary btn-sm">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"
                />
              </svg>
              <span>Manage</span>
            </button>
          </div>
        </div>
        } @if (searchQuery() && filteredServers().length === 0) {
        <div class="no-results">
          <div class="no-results-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
              />
            </svg>
          </div>
          <h3>No servers found</h3>
          <p>Try adjusting your search terms</p>
        </div>
        }
      </div>
    </div>
    }
  </main>
</div>
